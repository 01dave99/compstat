---
title: "Computational Statistics-Report"
author: "David Niederkofler, Erlend Lokna"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(HDInterval)
```



```{r}
mydata<-read.table("Report2_Dataset.txt", header=FALSE)
```
\section{Statistical Analysis of Covariates}
It is important to mention the use of notation before we proceed. We will in this section use the notation $\mathbf{x} = \{x_1, x_2, \cdots, x_n\}$ as our covariate vector.


\subsection{Ascicles}
```{r, include=FALSE}
mydata$V7<-as.numeric(mydata$V7)
```


\subsubsection{1.1 Model selection}
Since the Ascicles - covariate has a 0-1 outcome we can assume that it is Bernoulli distributed with parameter $\theta$. A natural conjugate prior for the Bernoulli distribution is the Beta distribution. The posterior beta distribution for the parameter is given by
$$Beta(\theta | a + \sum_{i = 1}^nx_i, b + n- \sum_{i + 1}^n x_i)$$
\subsubsection{1.2 Results}
The following results where found using the posterior beta distribution with a=1 and b=1 (Uniform distributed) for the ascicles data:
```{r, echo=FALSE}
n<-length(mydata$V6[!is.na(mydata$V7)])
s<-sum(mydata$V7)
mean<-(2+s)/(4+n)
mode<-(1+s)/(2+n)
cil<-qbeta(0.05/2, 1+s, 1 + n - s)
ciu<-qbeta(1-0.05/2,1+s, 1 + n - s)
cat("Posterior mean: ",mean)
cat("Posterior mode: ",mode)
cat("Centered 95% Confidence Interval: [",cil,",",ciu,"]")
```
With the following HPD interval:
```{r, echo = FALSE}
hdi(rbeta(1e5, 1+s, 1 + n - s))
```

```


\subsection{1. Sex}
```{r, include=FALSE}
mydata$V6<-as.numeric(mydata$V6)
```
The sex of the patients is encoded in a binary variable, where $0$ means \emph{male} and $1$ means \emph{female}.
\subsubsection{1.1 Model selection}
We assume a Bernoulli model $Ber(\theta)$ for the sex of the patient conditional on one parameter $\theta$, the probability of the patient to be female. The density function is given by
\begin{equation}
f(x|\theta)=\theta^x(1-\theta)^{1-x},
\end{equation}
where $x \in \{0,1\}$. As a prior distribution for $\theta$ we use the natural conjugate family of the Bernoulli distribution, namely the Beta distribution, $Beta(a,b)$, with two shape parameters $a=b=2$ to give more weight to the middle of the interval $[0,1]$, knowing how females and males are represented in the general population. The density is given by
\begin{equation}
h(\theta)=\frac{\Gamma(a+b)}{\Gamma(a) \Gamma(b)} \theta^{a-1} (1-\theta)^{b-1},
\end{equation}
for $\theta \in [0,1].$
\subsubsection{1.2 Results}
From the given dataset we get the sample size $n$ and the sum of the observations $s$:
```{r}
n<-length(mydata$V6[!is.na(mydata$V6)])
s<-sum(mydata$V6)
n
s
```
Therefore the posterior distribution is $Beta(2+s,2+n-s)$, which turns out to be $Beta(278,38)$.
From that we get
```{r, echo=FALSE}
mean<-(2+s)/(4+n)
mode<-(1+s)/(2+n)
cil<-qbeta(0.05/2,278,38)
ciu<-qbeta(1-0.05/2,278,38)
cat("Posterior mean: ",mean)
cat("Posterior mode: ",mode)
cat("Centered 95% Confidence Interval: [",cil,",",ciu,"]")
```
And the HPD confidence Interval calculates to:
```{r}
tst<-rbeta(1e5,278,38)
hdi(tst)
```
\subsection{2. Spiders}
```{r, include=FALSE}
mydata$V9<-as.numeric(mydata$V9)
```
The presence of spiders is encoded in a Binary variable, where $1$ means spiders are present.

\subsubsection{1.1 Model selection}
We assume a Bernoulli model $Ber(\theta)$ for the presence of spiders in patients conditional on one parameter $\theta$, the probability of the presence of spiders in the patient. The density function is given as stated earlier.
As a prior distribution for $\theta$ we use the natural conjugate family of the Bernoulli distribution, namely the Beta distribution, $Beta(a,b)$, with two shape parameters $a=b=1$, because we have no prior information. The density is given as above.

\subsubsection{1.2 Results}
From the given dataset we get the sample size $n$ and the sum of the observations $s$:
```{r}
n<-length(mydata$V9[!is.na(mydata$V9)])
s<-sum(mydata$V9)
n
s
```
Therefore the posterior distribution is $Beta(1+s,1+n-s)$, which turns out to be $Beta(91,223)$.
From that we get
```{r, echo=FALSE}
mean<-(2+s)/(4+n)
mode<-(1+s)/(2+n)
cil<-qbeta(0.05/2,91,223)
ciu<-qbeta(1-0.05/2,91,223)
cat("Posterior mean: ",mean)
cat("Posterior mode: ",mode)
cat("Centered 95% Confidence Interval: [",cil,",",ciu,"]")
```
And the HPD confidence interval calculates to:
```{r}
tst<-rbeta(1e5,91,223)
hdi(tst)
```
\subsection{3. Hepatomegaly}
```{r, include=FALSE}
mydata$V8<-as.numeric(mydata$V8)
```
The presence of hepatomegaly is encoded in a Binary variable, where $1$ means hepatomegaly is present.

\subsubsection{1.1 Model selection}
We assume a Bernoulli model $Ber(\theta)$ for the presence of hepatomegaly in the patient, conditional on one parameter $\theta$, the probability of the presence of hepatomegaly in the patient. The density function is given as stated earlier.
As a prior distribution for $\theta$ we use the natural conjugate family of the Bernoulli distribution, namely the Beta distribution, $Beta(a,b)$, with two shape parameters $a=b=1$, because we have no prior information. The density is given as above.

\subsubsection{1.2 Results}
From the given dataset we get the sample size $n$ and the sum of the observations $s$:
```{r}
n<-length(mydata$V8[!is.na(mydata$V8)])
s<-sum(mydata$V8)
n
s
```
Therefore the posterior distribution is $Beta(1+s,1+n-s)$, which turns out to be $Beta(161,153)$.
From that we get
```{r, echo=FALSE}
mean<-(2+s)/(4+n)
mode<-(1+s)/(2+n)
cil<-qbeta(0.05/2,161,153)
ciu<-qbeta(1-0.05/2,161,153)
cat("Posterior mean: ",mean)
cat("Posterior mode: ",mode)
cat("Centered 95% Confidence Interval: [",cil,",",ciu,"]")
```
And the HPD confidence interval calculates to:
```{r}
tst<-rbeta(1e5,161,153)
hdi(tst)
```
\subsection{4. Histologic stage}
The Histologic stage of the disease is a number in $\{1,2,3,4\}$, where the stage increases with severeness. We will give here the frequencies of the stages in the dataset.
```{r, echo=FALSE}
mydata$V20<- factor(mydata$V20,levels=c(1,2,3,4),labels=c("1","2","3","4"))
summary(mydata$V20)
```
We see that, most patients have been diagnosed in the last to stages of the disease.







# Appendix
## Bernoulli/Beta
A natural conjugate prior for the Bernoulli distribution is the Beta distribution. 
$$f(x_i|\theta) = \theta^{x_i}(1-\theta)^{1-x_i}$$
$$L(\mathbf{x} | \theta) = \theta^{\sum_{i=1}^n x_ i}(1- \theta)^{n - \sum_{i=1}^n x_i } $$
$$h(\theta) = Beta(a, b)$$
We proceed by calculating the posterior distribution for $\theta$
$$h(\theta | \mathbf{x}) \propto L(\mathbf{x} | \theta) h(\theta) = \theta^{\sum_{i=1}^n x_ i}(1- \theta)^{n - \sum_{i=1}^n x_i } \frac{1}{B(a, b)} \theta^{a-1}(1-\theta)^{b-1} I(0 < \theta < 1)$$
$$\propto Beta(\theta | a + \sum_{i = 1}^nx_i, b + n- \sum_{i + 1}^n x_i) $$

## Poisson/Gamma
If our data $X_1, \cdot, X_n$ are iid Poisson($\lambda$) distributed then a gamma($\alpha$, $\beta$) prior on $\lambda$ is a conjugate prior.
The Likelyhood function is:
$$L(\lambda | \mathbf{x}) = \prod_{i=1}^n \frac{e^{-\lambda}\lambda^{\sum_{i=1}^n x_i}}{x_i !} = \frac{e^{-\lambda}\lambda^{\sum_{i=1}^n x_i}}{\prod_{i=1}^n x_i !}$$

Our gamma prior has the expression:
$$ h(\lambda) = \frac{\beta^{\alpha}}{\Gamma(\alpha)} \lambda^{\alpha-1} e^{-\beta \lambda} $$

Using bayes rule we find the following posterior:
$$h(\lambda | \mathbf{x}) \propto h(\lambda) L(\mathbf{x}|\lambda) \propto \lambda^{\sum_{i=1}^n x_i + \alpha -1} e^{-(n+\beta)\lambda}$$

$$\propto gamma(\sum_{i=1}^n x_i + \alpha, n+\beta)$$
